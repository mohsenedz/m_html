<head>  
  <meta charset="UTF-8">  
  <title>مشروعي</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <style>  
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #topbar {
      height: 50px;
      background-color: #333;
      color: white;
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 10px;
    }
    #topbar button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    #main {
      position: relative;
      height: calc(100% - 50px);
    }
    #sidebar {
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background-color: #f4f4f4;
      overflow: hidden;
      box-sizing: border-box;
      padding: 0;
      transition: width 0.4s ease, padding 0.4s ease;
      z-index: 10;
    }
    #sidebar.active {
      width: 80vw;
      padding: 20px;
      overflow-y: auto;
    }
    #editor, #textEditor {
      width: 100%;
      height: 100%;
    }
    .sidebar-button {
      display: block;
      margin-bottom: 15px;
      padding: 14px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      font-size: 18px;
      text-align: right;
    }
    #textEditor {
      position: absolute;
      top: 0;
      left: 0;
      padding: 10px;
      box-sizing: border-box;
      font-size: 16px;
      display: none;
      z-index: 9;
      direction: ltr;
      font-family: monospace;
    }
    #previewWindow {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      height: 200px;
      background: #111;
      color: #0f0;
      display: none;
      flex-direction: column;
      z-index: 1000;
    }
    #closePreview {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px;
      font-size: 14px;
      cursor: pointer;
      align-self: flex-end;
      margin: 4px;
    }
    #consoleOutput {
      flex-grow: 1;
      padding: 10px;
      font-family: monospace;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .file-tree {
      list-style: none;
      padding: 0;
      margin: 10px 0 0;
      font-size: 16px;
    }

    .file-tree li {
      margin: 5px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .file-icon {
      width: 18px;
      height: 18px;
    }


.file-tree li.selected {
  background-color: #d0e7ff;
  border-radius: 4px;
  padding: 4px;
}

  </style>  
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs/loader.js"></script>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>  
<body>  
  <div id="topbar">  
    <button id="toggleSidebar">Add</button>  
    <button id="runCode">Run</button>  
    <button id="showTextEditor">S</button>  
    <button id="backToEditor">B</button>  
  </div>  
  <div id="main">  
    <div id="sidebar">  
      <button class="sidebar-button" id="addFileBtn">إضافة ملف من الهاتف</button>  
      <button class="sidebar-button">إنشاء ملف جديد</button>  
      <button class="sidebar-button">إعادة تسمية</button>  
      <button class="sidebar-button">حذف</button>  
      <button class="sidebar-button">تحميل المشروع كـ ZIP</button>  
      <button class="sidebar-button">مشاركة المشروع</button>  

      <!-- شجرة الملفات -->
      <ul class="file-tree" id="fileTree">
        <li><i class="fas fa-file-code file-icon"></i> index.html</li>
        <li><i class="fas fa-file-css file-icon"></i> style.css</li>
        <li><i class="fas fa-file-js file-icon"></i> script.js</li>
        <li><i class="fas fa-image file-icon"></i> logo.png</li>
        <li><i class="fas fa-file-pdf file-icon"></i> info.pdf</li>
      </ul>

    </div>  
    <div id="editor"></div>  
    <textarea id="textEditor"></textarea>  
  </div>  
  <div id="previewWindow">  
    <button id="closePreview">X</button>  
    <div id="consoleOutput"></div>  
  </div>  
  <script>  
    let editor;  
    const textEditor = document.getElementById("textEditor");  
    const editorDiv = document.getElementById("editor");  
    const previewWindow = document.getElementById("previewWindow");  
    const consoleOutput = document.getElementById("consoleOutput");

    document.getElementById("toggleSidebar").addEventListener("click", () => {  
      document.getElementById("sidebar").classList.toggle("active");  
    });  

    // Function to handle file selection and update the file tree
    document.getElementById("addFileBtn").addEventListener("click", () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.multiple = true; // Allow multiple files to be selected
      input.click();

      input.addEventListener('change', (e) => {
        const files = e.target.files;
        const fileTree = document.getElementById('fileTree');
        
        // Add selected files to the file tree
        Array.from(files).forEach(file => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `<i class="fas fa-file file-icon"></i> ${file.name}`;
          fileTree.appendChild(listItem);
        });
      });
    });

    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs' } });  
    require(['vs/editor/editor.main'], function () {  
      editor = monaco.editor.create(document.getElementById('editor'), {  
        value: `<!DOCTYPE html>\n<html>\n  <body>\n    <h1>Hello!</h1>\n    <script>\n      console.log("مرحبًا بالعالم");\n      console.log("تم تشغيل الكود");\n    <\/script>\n  </body>\n</html>`,  
        language: 'html',  
        theme: 'vs-dark',  
        automaticLayout: true  
      });  
    });  

    document.getElementById("runCode").addEventListener("click", () => {  
      const code = editor.getValue();  
      const iframe = document.createElement('iframe');  
      iframe.style.display = 'none';  
      document.body.appendChild(iframe);  
      const script = `  
        <script>  
          const oldLog = console.log;  
          console.log = function(...args) {  
            parent.postMessage({ type: 'log', message: args.join(' ') }, '*');  
            oldLog.apply(console, args);  
          };  
        <\/script>  
      `;  
      const html = script + code;  
      const blob = new Blob([html], { type: 'text/html' });  
      const url = URL.createObjectURL(blob);  
      iframe.src = url;  

      previewWindow.style.display = 'flex';  
      window.addEventListener('message', function (e) {  
        if (e.data.type === 'log') {  
          consoleOutput.textContent += e.data.message + '\n';  
        }  
      });  
    });  

    document.getElementById("closePreview").addEventListener("click", () => {  
      previewWindow.style.display = 'none';  
      consoleOutput.textContent = '';  
    });  
  
  
  
const fileTree = document.querySelector('.file-tree');
const newFileBtn = document.querySelectorAll('.sidebar-button')[1]; // زر "إنشاء ملف جديد"
const fileContents = {}; // لتخزين محتوى كل ملف
let currentFile = null; // اسم الملف الحالي المفتوح

// إنشاء ملف جديد عند الضغط على الزر
newFileBtn.addEventListener('click', () => {
  const fileName = prompt("أدخل اسم الملف (مثال: index.html):");
  if (!fileName) return;

  // إنشاء العنصر في شجرة الملفات
  const li = document.createElement('li');
  const icon = document.createElement('i');
  icon.className = `fas file-icon ${getFileIconClass(fileName)}`;
  li.appendChild(icon);
  li.appendChild(document.createTextNode(' ' + fileName));
  fileTree.appendChild(li);

  // إعداد المحتوى المبدئي للملف
  fileContents[fileName] = "";

  // ربط الحدث بالنقر لفتح الملف
  li.addEventListener('click', () => {
    openFile(fileName);
  });

  // إذا كان نوع الملف مدعومًا، افتحه تلقائيًا
  if (fileName.endsWith('.html') || fileName.endsWith('.css') || fileName.endsWith('.js')) {
    openFile(fileName);
  }
});

// تحديد نوع الأيقونة حسب الامتداد
function getFileIconClass(fileName) {
  if (fileName.endsWith('.html') || fileName.endsWith('.htm')) return 'fa-file-code';
  if (fileName.endsWith('.css')) return 'fa-file-css';
  if (fileName.endsWith('.js')) return 'fa-file-js';
  if (fileName.endsWith('.png') || fileName.endsWith('.jpg')) return 'fa-image';
  if (fileName.endsWith('.pdf')) return 'fa-file-pdf';
  return 'fa-file';
}

// فتح الملف في المحرر
function openFile(fileName) {
  currentFile = fileName;
  const content = fileContents[fileName] || "";
  editor.setValue(content);
}

// حفظ التغييرات تلقائيًا في الملف الحالي
editor.onDidChangeModelContent(() => {
  if (currentFile) {
    fileContents[currentFile] = editor.getValue();
  }
});

  
const renameFileBtn = document.querySelectorAll('.sidebar-button')[2]; // زر إعادة التسمية

renameFileBtn.addEventListener('click', () => {
  if (!currentFile) {
    alert("لم يتم تحديد أي ملف لإعادة تسميته.");
    return;
  }

  const newFileName = prompt("أدخل الاسم الجديد للملف:", currentFile);
  if (!newFileName || newFileName === currentFile) return;

  // تحديث المحتوى
  fileContents[newFileName] = fileContents[currentFile];
  delete fileContents[currentFile];

  // تحديث الملف الحالي
  currentFile = newFileName;

  // تحديث المحرر إذا كان الملف مفتوح
  editor.setValue(fileContents[newFileName]);

  // تحديث اسم الملف في شجرة الملفات
  const fileItems = document.querySelectorAll('.file-tree li');
  fileItems.forEach(item => {
    if (item.textContent.trim() === currentFile || item.textContent.trim() === newFileName) {
      item.childNodes[1].nodeValue = ' ' + newFileName; // تعديل النص بعد الأيقونة
    }
  });
});
  
  
  
  
  document.querySelectorAll("#fileTree li").forEach((item) => {
  item.addEventListener("click", () => {
    // إزالة التحديد من جميع العناصر
    document.querySelectorAll("#fileTree li").forEach((li) => {
      li.classList.remove("selected");
    });
    // تفعيل التحديد على العنصر الذي تم النقر عليه
    item.classList.add("selected");
  });
});

  
  






const fileTree = document.getElementById("fileTree");

fileTree.addEventListener("click", (e) => {
  const li = e.target.closest("li");
  if (!li) return;

  // إزالة التحديد من كل العناصر
  fileTree.querySelectorAll("li").forEach(item => item.classList.remove("selected"));

  // تمييز العنصر المحدد
  li.classList.add("selected");

  // إذا أردت تنفيذ شيء عند تحديد الملف (مثلاً فتحه في المحرر)، أضف الكود هنا
  console.log("تم تحديد الملف:", li.textContent.trim());
});


    
  </script>  
 
</body>
